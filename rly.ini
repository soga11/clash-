;===============================================================
; ACL4SSR + blackmatrix7 混合规则 - 修复版 v2.4
; 新增：故障转移策略组
; 修复：DNS 查询被错误匹配到哔哩哔哩的问题
;===============================================================

;================= 规则部分（规则顺序很重要！）=================

; === 第 0 优先级：DNS 直连（必须在最前面！）===
ruleset=全球直连,[]IP-CIDR,223.5.5.5/32,no-resolve
ruleset=全球直连,[]IP-CIDR,223.6.6.6/32,no-resolve
ruleset=全球直连,[]IP-CIDR,119.29.29.29/32,no-resolve
ruleset=全球直连,[]IP-CIDR,119.28.28.28/32,no-resolve
ruleset=全球直连,[]IP-CIDR,180.76.76.76/32,no-resolve
ruleset=全球直连,[]IP-CIDR,114.114.114.114/32,no-resolve
ruleset=全球直连,[]IP-CIDR,1.2.4.8/32,no-resolve
ruleset=全球直连,[]IP-CIDR,210.2.4.8/32,no-resolve

; === 第 1 优先级：基础规则 ===
ruleset=全球直连,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/LocalAreaNetwork.list
ruleset=全球直连,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/UnBan.list

; === 第 2 优先级：广告拦截 ===
ruleset=拦截规则,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/BanAD.list
ruleset=拦截规则,https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/Advertising/Advertising.yaml
ruleset=拦截规则,https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/Privacy/Privacy.yaml
ruleset=拦截规则,https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/Hijacking/Hijacking.yaml

; === 第 3 优先级：应用净化 ===
ruleset=拦截规则,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/BanProgramAD.list
ruleset=拦截规则,https://raw.githubusercontent.com/cmliu/ACL4SSR/main/Clash/adobe.list
ruleset=拦截规则,https://raw.githubusercontent.com/cmliu/ACL4SSR/main/Clash/IDM.list

; === 第 4 优先级：专用应用规则 ===

; ChatGPT / AI
ruleset=ChatGPT,[]DOMAIN-SUFFIX,openai.com
ruleset=ChatGPT,[]DOMAIN-SUFFIX,chatgpt.com
ruleset=ChatGPT,[]DOMAIN-SUFFIX,oaistatic.com
ruleset=ChatGPT,[]DOMAIN-SUFFIX,oaiusercontent.com
ruleset=ChatGPT,[]DOMAIN-SUFFIX,ai.com
ruleset=ChatGPT,[]DOMAIN-SUFFIX,anthropic.com
ruleset=ChatGPT,[]DOMAIN-SUFFIX,claude.ai
ruleset=ChatGPT,[]DOMAIN-SUFFIX,genspark.ai
ruleset=ChatGPT,[]DOMAIN,gemini.google.com
ruleset=ChatGPT,[]DOMAIN,bard.google.com
ruleset=ChatGPT,[]DOMAIN,copilot.microsoft.com
ruleset=ChatGPT,[]DOMAIN-SUFFIX,perplexity.ai
ruleset=ChatGPT,[]DOMAIN-SUFFIX,midjourney.com
ruleset=ChatGPT,[]DOMAIN-SUFFIX,deepl.com
ruleset=ChatGPT,[]DOMAIN-SUFFIX,notion.so
ruleset=ChatGPT,[]DOMAIN-SUFFIX,character.ai
ruleset=ChatGPT,[]DOMAIN-SUFFIX,huggingface.co
ruleset=ChatGPT,[]DOMAIN-SUFFIX,cursor.sh
ruleset=ChatGPT,[]DOMAIN-SUFFIX,runwayml.com
ruleset=ChatGPT,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/Ruleset/OpenAi.list
ruleset=ChatGPT,https://raw.githubusercontent.com/juewuy/ShellClash/master/rules/ai.list
ruleset=ChatGPT,https://raw.githubusercontent.com/cmliu/ACL4SSR/main/Clash/Copilot.list
ruleset=ChatGPT,https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/OpenAI/OpenAI.yaml

; 微软服务
ruleset=微软服务,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/Bing.list
ruleset=微软服务,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/OneDrive.list
ruleset=微软服务,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/Microsoft.list

; 游戏平台
ruleset=游戏平台,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/Ruleset/Steam.list
ruleset=游戏平台,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/Ruleset/Epic.list
ruleset=游戏平台,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/Ruleset/Sony.list
ruleset=游戏平台,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/Ruleset/Nintendo.list

; TikTok
ruleset=TikTok,[]DOMAIN-SUFFIX,tiktok.com
ruleset=TikTok,[]DOMAIN-SUFFIX,tiktokv.com
ruleset=TikTok,[]DOMAIN-SUFFIX,tiktokcdn.com
ruleset=TikTok,[]DOMAIN-SUFFIX,byteoversea.com
ruleset=TikTok,[]DOMAIN-SUFFIX,musical.ly
ruleset=TikTok,[]DOMAIN-KEYWORD,tiktok

; YouTube
ruleset=油管视频,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/Ruleset/YouTube.list

; Netflix
ruleset=奈飞视频,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/Ruleset/Netflix.list

; 巴哈姆特
ruleset=巴哈姆特,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/Ruleset/Bahamut.list

; 哔哩哔哩（港澳台）
ruleset=哔哩哔哩,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/Ruleset/BilibiliHMT.list
ruleset=哔哩哔哩,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/Ruleset/Bilibili.list

; 国内/国外媒体
ruleset=国内媒体,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/ChinaMedia.list
ruleset=国外媒体,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/ProxyMedia.list
ruleset=国外媒体,https://raw.githubusercontent.com/cmliu/ACL4SSR/main/Clash/Emby.list

; 香港流媒体
ruleset=香港流媒体,[]DOMAIN-SUFFIX,mytvsuper.com
ruleset=香港流媒体,[]DOMAIN-SUFFIX,tvb.com
ruleset=香港流媒体,[]DOMAIN-SUFFIX,tvbanywhere.com
ruleset=香港流媒体,[]DOMAIN-SUFFIX,bigbigchannel.com.hk

; Telegram
ruleset=电报消息,[]IP-CIDR,91.108.0.0/16,no-resolve
ruleset=电报消息,[]IP-CIDR,149.154.0.0/16,no-resolve
ruleset=电报消息,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/Telegram.list

; === 第 5 优先级：直连服务 ===
ruleset=直连优先,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/Apple.list
ruleset=直连优先,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/Ruleset/GoogleFCM.list
ruleset=直连优先,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/Ruleset/NetEaseMusic.list

; === 第 6 优先级：GFW 列表 ===
ruleset=节点选择,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/ProxyGFWlist.list
ruleset=节点选择,https://raw.githubusercontent.com/UlinoyaPed/ShellClash/dev/lists/proxy.list

; === 第 7 优先级：中国大陆直连 ===
ruleset=全球直连,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/GoogleCN.list
ruleset=全球直连,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/Ruleset/SteamCN.list
ruleset=全球直连,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/ChinaDomain.list
ruleset=全球直连,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/ChinaCompanyIp.list
ruleset=全球直连,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/Download.list
ruleset=全球直连,[]GEOIP,CN,no-resolve

; === 第 8 优先级：兜底 ===
ruleset=漏网之鱼,[]FINAL


;================= 策略组部分（新增故障转移）=================

; === 主选择 ===
custom_proxy_group=节点选择`select`[]AWS香港负载`[]AWS台湾负载`[]新加坡负载`[]香港负载`[]美国负载`[]澳门负载`[]AWS东京负载`[]自动选择`[]故障转移`[]DIRECT`.*

; === 自动选择 & 故障转移（新增！）===
custom_proxy_group=自动选择`url-test`.*`https://www.cloudflare.com/cdn-cgi/trace`600,,50
custom_proxy_group=故障转移`fallback`.*`https://www.cloudflare.com/cdn-cgi/trace`600,,50

; === 负载均衡 ===
custom_proxy_group=澳门负载`load-balance`(澳门|debee|Macao)`https://www.youtube.com/generate_204`480,,80
custom_proxy_group=新加坡负载`load-balance`(新加坡|SG|Singapore)`https://www.cloudflare.com/cdn-cgi/trace`360,,50
custom_proxy_group=香港负载`load-balance`(香港电视|HK电视|TVB)`https://www.cloudflare.com/cdn-cgi/trace`480,,60
custom_proxy_group=AWS香港负载`load-balance`(aws香港hy2)`https://www.cloudflare.com/cdn-cgi/trace`600,,40
custom_proxy_group=AWS台湾负载`load-balance`(aws台湾hy2)`https://www.cloudflare.com/cdn-cgi/trace`600,,40
custom_proxy_group=AWS东京负载`load-balance`(aws东京|Tokyo)`https://www.cloudflare.com/cdn-cgi/trace`360,,50
custom_proxy_group=美国负载`load-balance`(洛杉矶|aws洛|美国|US)`https://www.cloudflare.com/cdn-cgi/trace`600,,80

; === 应用专用 ===
custom_proxy_group=油管视频`select`[]澳门负载`[]美国负载`[]AWS东京负载`[]节点选择`[]故障转移`(澳门|debee)`.*
custom_proxy_group=香港流媒体`select`[]香港负载`[]澳门负载`[]AWS香港负载`[]节点选择`[]故障转移`(香港电视|TVB)`.*
custom_proxy_group=ChatGPT`select`[]美国负载`[]新加坡负载`[]AWS东京负载`[]节点选择`[]故障转移`[]DIRECT`(美国|US)`.*
custom_proxy_group=电报消息`select`[]新加坡负载`[]节点选择`[]自动选择`[]故障转移
custom_proxy_group=TikTok`select`[]美国负载`[]新加坡负载`[]节点选择`[]故障转移`(美国|US|SG)`.*
custom_proxy_group=奈飞视频`select`[]美国负载`[]AWS东京负载`[]节点选择`[]故障转移`(美国|US)`.*
custom_proxy_group=巴哈姆特`select`[]AWS台湾负载`[]节点选择`[]故障转移`(台|TW)`.*
custom_proxy_group=哔哩哔哩`select`[]全球直连`[]AWS台湾负载`[]AWS香港负载`[]节点选择`[]故障转移
custom_proxy_group=国内媒体`select`[]DIRECT`[]AWS香港负载`[]节点选择
custom_proxy_group=国外媒体`select`[]节点选择`[]AWS香港负载`[]澳门负载`[]自动选择`[]故障转移
custom_proxy_group=微软服务`select`[]DIRECT`[]美国负载`[]节点选择`[]故障转移
custom_proxy_group=游戏平台`select`[]DIRECT`[]AWS东京负载`[]美国负载`[]节点选择`[]故障转移

; === 通用组（合并） ===
custom_proxy_group=直连优先`select`[]DIRECT`[]节点选择
custom_proxy_group=拦截规则`select`[]REJECT`[]DIRECT
custom_proxy_group=全球直连`select`[]DIRECT`[]节点选择
custom_proxy_group=漏网之鱼`select`[]节点选择`[]自动选择`[]故障转移`[]DIRECT`.*


;================= 规则生成器设置 =================
enable_rule_generator=true
overwrite_original_rules=true
