;===============================================================
; ACL4SSR + blackmatrix7 混合规则 - 生产优化版 v2.6
; 优化：使用本地移动 DNS，速度最快
;===============================================================

;================= 规则部分（规则顺序很重要！）=================

; === 第 0 优先级：DNS 直连（本地移动 DNS 优先）===
ruleset=全球直连,[]IP-CIDR,211.138.240.100/32,no-resolve
ruleset=全球直连,[]IP-CIDR,211.138.245.180/32,no-resolve
ruleset=全球直连,[]IP-CIDR6,2409:805c:2000:3000::1000/128,no-resolve
ruleset=全球直连,[]IP-CIDR6,2409:805c:2000:3001::1000/128,no-resolve
ruleset=全球直连,[]IP-CIDR,223.5.5.5/32,no-resolve
ruleset=全球直连,[]IP-CIDR,223.6.6.6/32,no-resolve
ruleset=全球直连,[]IP-CIDR,119.29.29.29/32,no-resolve
ruleset=全球直连,[]IP-CIDR,119.28.28.28/32,no-resolve
ruleset=全球直连,[]IP-CIDR,180.76.76.76/32,no-resolve
ruleset=全球直连,[]IP-CIDR,114.114.114.114/32,no-resolve

; === 第 1 优先级：基础规则 ===
ruleset=全球直连,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/LocalAreaNetwork.list
ruleset=全球直连,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/UnBan.list

; === 第 2 优先级：广告拦截 ===
ruleset=广告拦截,https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/Advertising/Advertising.yaml
ruleset=广告拦截,https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/Privacy/Privacy.yaml
ruleset=广告拦截,https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/Hijacking/Hijacking.yaml

; === 第 3 优先级：专用应用规则（必须放在 GFW 列表前面！）===

; ---------- ChatGPT / OpenAI ----------
ruleset=ChatGPT,[]DOMAIN-SUFFIX,openai.com
ruleset=ChatGPT,[]DOMAIN-SUFFIX,chatgpt.com
ruleset=ChatGPT,[]DOMAIN-SUFFIX,oaistatic.com
ruleset=ChatGPT,[]DOMAIN-SUFFIX,oaiusercontent.com
ruleset=ChatGPT,[]DOMAIN-SUFFIX,ai.com
ruleset=ChatGPT,[]DOMAIN-SUFFIX,identrust.com
ruleset=ChatGPT,[]DOMAIN-SUFFIX,intercom.io
ruleset=ChatGPT,[]DOMAIN-SUFFIX,intercomcdn.com
ruleset=ChatGPT,[]DOMAIN-SUFFIX,sentry.io
ruleset=ChatGPT,[]DOMAIN-SUFFIX,segment.io
ruleset=ChatGPT,[]DOMAIN-SUFFIX,statsigapi.net
ruleset=ChatGPT,[]DOMAIN-SUFFIX,algolia.net
ruleset=ChatGPT,[]DOMAIN-SUFFIX,featuregates.org
ruleset=ChatGPT,[]DOMAIN-SUFFIX,challenges.cloudflare.com
ruleset=ChatGPT,[]DOMAIN-SUFFIX,client-api.arkoselabs.com
ruleset=ChatGPT,[]DOMAIN-SUFFIX,chatgpt.livekit.cloud
ruleset=ChatGPT,[]DOMAIN-SUFFIX,host.livekit.cloud
ruleset=ChatGPT,[]DOMAIN-SUFFIX,turn.livekit.cloud
ruleset=ChatGPT,[]DOMAIN-SUFFIX,poe.com
ruleset=ChatGPT,[]DOMAIN-KEYWORD,openai
ruleset=ChatGPT,[]DOMAIN-KEYWORD,chatgpt

; Claude / Anthropic
ruleset=ChatGPT,[]DOMAIN-SUFFIX,anthropic.com
ruleset=ChatGPT,[]DOMAIN-SUFFIX,claude.ai
ruleset=ChatGPT,[]DOMAIN-SUFFIX,anthropic-api.com
ruleset=ChatGPT,[]DOMAIN-KEYWORD,claude
ruleset=ChatGPT,[]DOMAIN-KEYWORD,anthropic

; Genspark AI
ruleset=ChatGPT,[]DOMAIN-SUFFIX,genspark.ai
ruleset=ChatGPT,[]DOMAIN-SUFFIX,genspark.com
ruleset=ChatGPT,[]DOMAIN-SUFFIX,www.genspark.ai
ruleset=ChatGPT,[]DOMAIN-SUFFIX,api.genspark.ai
ruleset=ChatGPT,[]DOMAIN-SUFFIX,cdn.genspark.ai
ruleset=ChatGPT,[]DOMAIN-SUFFIX,app.genspark.ai
ruleset=ChatGPT,[]DOMAIN-SUFFIX,static.genspark.ai
ruleset=ChatGPT,[]DOMAIN-SUFFIX,assets.genspark.ai
ruleset=ChatGPT,[]DOMAIN-KEYWORD,genspark

; Google Gemini（精确匹配）
ruleset=ChatGPT,[]DOMAIN,gemini.google.com
ruleset=ChatGPT,[]DOMAIN,bard.google.com
ruleset=ChatGPT,[]DOMAIN,aistudio.google.com
ruleset=ChatGPT,[]DOMAIN,makersuite.google.com
ruleset=ChatGPT,[]DOMAIN,generativelanguage.googleapis.com
ruleset=ChatGPT,[]DOMAIN-KEYWORD,gemini
ruleset=ChatGPT,[]DOMAIN-KEYWORD,bard

; Microsoft Copilot（缩小范围）
ruleset=ChatGPT,[]DOMAIN,copilot.microsoft.com
ruleset=ChatGPT,[]DOMAIN,sydney.bing.com
ruleset=ChatGPT,[]DOMAIN,edgeservices.bing.com
ruleset=ChatGPT,[]DOMAIN-KEYWORD,copilot

; Perplexity AI
ruleset=ChatGPT,[]DOMAIN-SUFFIX,perplexity.ai
ruleset=ChatGPT,[]DOMAIN-SUFFIX,pplx.ai
ruleset=ChatGPT,[]DOMAIN-KEYWORD,perplexity

; Midjourney
ruleset=ChatGPT,[]DOMAIN-SUFFIX,midjourney.com
ruleset=ChatGPT,[]DOMAIN-SUFFIX,cdn.midjourney.com
ruleset=ChatGPT,[]DOMAIN-KEYWORD,midjourney

; DeepL
ruleset=ChatGPT,[]DOMAIN-SUFFIX,deepl.com
ruleset=ChatGPT,[]DOMAIN-SUFFIX,deepl.net
ruleset=ChatGPT,[]DOMAIN-SUFFIX,www2.deepl.com
ruleset=ChatGPT,[]DOMAIN-KEYWORD,deepl

; Notion AI
ruleset=ChatGPT,[]DOMAIN-SUFFIX,notion.so
ruleset=ChatGPT,[]DOMAIN-SUFFIX,notion.site
ruleset=ChatGPT,[]DOMAIN-SUFFIX,notion.com
ruleset=ChatGPT,[]DOMAIN-SUFFIX,notion-static.com
ruleset=ChatGPT,[]DOMAIN-KEYWORD,notion

; Character.AI
ruleset=ChatGPT,[]DOMAIN-SUFFIX,character.ai
ruleset=ChatGPT,[]DOMAIN-SUFFIX,characterai.io
ruleset=ChatGPT,[]DOMAIN-KEYWORD,character

; HuggingFace
ruleset=ChatGPT,[]DOMAIN-SUFFIX,huggingface.co
ruleset=ChatGPT,[]DOMAIN-SUFFIX,hf.co
ruleset=ChatGPT,[]DOMAIN-SUFFIX,huggingface.space
ruleset=ChatGPT,[]DOMAIN-KEYWORD,huggingface

; Cursor
ruleset=ChatGPT,[]DOMAIN-SUFFIX,cursor.sh
ruleset=ChatGPT,[]DOMAIN-SUFFIX,cursor.com
ruleset=ChatGPT,[]DOMAIN-SUFFIX,cursor.directory
ruleset=ChatGPT,[]DOMAIN-KEYWORD,cursor

; Runway ML
ruleset=ChatGPT,[]DOMAIN-SUFFIX,runwayml.com
ruleset=ChatGPT,[]DOMAIN-SUFFIX,runway.com
ruleset=ChatGPT,[]DOMAIN-SUFFIX,app.runwayml.com
ruleset=ChatGPT,[]DOMAIN-KEYWORD,runway

; blackmatrix7 OpenAI 规则（补充）
ruleset=ChatGPT,https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/OpenAI/OpenAI.yaml

; ---------- TikTok ----------
ruleset=TikTok,[]DOMAIN-SUFFIX,tiktokv.eu
ruleset=TikTok,[]DOMAIN-SUFFIX,tiktokv.us
ruleset=TikTok,[]DOMAIN-SUFFIX,tiktokv.com
ruleset=TikTok,[]DOMAIN-SUFFIX,tiktokcdn.com
ruleset=TikTok,[]DOMAIN-SUFFIX,tiktokcdn-us.com
ruleset=TikTok,[]DOMAIN-SUFFIX,tiktok.com
ruleset=TikTok,[]DOMAIN-SUFFIX,byteoversea.com
ruleset=TikTok,[]DOMAIN-SUFFIX,bytedapm.com
ruleset=TikTok,[]DOMAIN-SUFFIX,bytegecko.com
ruleset=TikTok,[]DOMAIN-SUFFIX,bytegecko-i18n.com
ruleset=TikTok,[]DOMAIN-SUFFIX,musical.ly
ruleset=TikTok,[]DOMAIN-SUFFIX,ibyteimg.com
ruleset=TikTok,[]DOMAIN-SUFFIX,ibytedtos.com
ruleset=TikTok,[]DOMAIN-SUFFIX,ipstatp.com
ruleset=TikTok,[]DOMAIN-SUFFIX,muscdn.com
ruleset=TikTok,[]DOMAIN-SUFFIX,ttlivecdn.com
ruleset=TikTok,[]DOMAIN-SUFFIX,tlivecdn.com
ruleset=TikTok,[]DOMAIN-SUFFIX,snssdk.com
ruleset=TikTok,[]DOMAIN-SUFFIX,sgsnssdk.com
ruleset=TikTok,[]DOMAIN-SUFFIX,sgpstatp.com
ruleset=TikTok,[]DOMAIN-SUFFIX,isnssdk.com
ruleset=TikTok,[]DOMAIN-SUFFIX,tiktokd.net
ruleset=TikTok,[]DOMAIN-SUFFIX,tiktokd.org
ruleset=TikTok,[]DOMAIN-SUFFIX,ttwstatic.com
ruleset=TikTok,[]DOMAIN-SUFFIX,ttoverseaus.net
ruleset=TikTok,[]DOMAIN-SUFFIX,capcut.com
ruleset=TikTok,[]DOMAIN-SUFFIX,amemv.com
ruleset=TikTok,[]DOMAIN-SUFFIX,toutiao.com
ruleset=TikTok,[]DOMAIN-KEYWORD,tiktok
ruleset=TikTok,[]DOMAIN-KEYWORD,musical
ruleset=TikTok,[]DOMAIN-KEYWORD,bytedance
ruleset=TikTok,https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/TikTok/TikTok.yaml

; ---------- YouTube ----------
ruleset=油管视频,[]DOMAIN-SUFFIX,youtube.com
ruleset=油管视频,[]DOMAIN-SUFFIX,youtu.be
ruleset=油管视频,[]DOMAIN-SUFFIX,googlevideo.com
ruleset=油管视频,[]DOMAIN-SUFFIX,ytimg.com
ruleset=油管视频,[]DOMAIN-SUFFIX,ggpht.com
ruleset=油管视频,[]DOMAIN-KEYWORD,youtube
ruleset=油管视频,https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/YouTube/YouTube.yaml

; ---------- Netflix / HBO Max ----------
ruleset=奈飞视频,[]DOMAIN-SUFFIX,netflix.com
ruleset=奈飞视频,[]DOMAIN-SUFFIX,nflxvideo.net
ruleset=奈飞视频,[]DOMAIN-SUFFIX,nflximg.net
ruleset=奈飞视频,[]DOMAIN-SUFFIX,nflxso.net
ruleset=奈飞视频,[]DOMAIN-SUFFIX,nflxext.com
ruleset=奈飞视频,[]DOMAIN-SUFFIX,hbomax.com
ruleset=奈飞视频,[]DOMAIN-SUFFIX,max.com
ruleset=奈飞视频,[]DOMAIN-SUFFIX,hbo.com
ruleset=奈飞视频,[]DOMAIN-KEYWORD,netflix
ruleset=奈飞视频,[]DOMAIN-KEYWORD,hbomax
ruleset=奈飞视频,https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/Netflix/Netflix.yaml

; ---------- 香港流媒体 ----------
ruleset=香港流媒体,[]DOMAIN-SUFFIX,mytvsuper.com
ruleset=香港流媒体,[]DOMAIN-SUFFIX,tvb.com
ruleset=香港流媒体,[]DOMAIN-SUFFIX,tvbanywhere.com
ruleset=香港流媒体,[]DOMAIN-SUFFIX,tvbusa.com
ruleset=香港流媒体,[]DOMAIN-SUFFIX,bigbigchannel.com.hk
ruleset=香港流媒体,[]DOMAIN-SUFFIX,encoretvb.com
ruleset=香港流媒体,[]DOMAIN-KEYWORD,mytvsuper
ruleset=香港流媒体,[]DOMAIN-KEYWORD,tvb
ruleset=香港流媒体,https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/myTVSUPER/myTVSUPER.yaml

; ---------- Telegram（增强：添加 IP-CIDR）----------
ruleset=电报消息,[]IP-CIDR,91.108.0.0/16,no-resolve
ruleset=电报消息,[]IP-CIDR,149.154.0.0/16,no-resolve
ruleset=电报消息,https://cdn.jsdelivr.net/gh/blackmatrix7/ios_rule_script@master/rule/Clash/Telegram/Telegram.yaml

; === 第 4 优先级：苹果服务 ===
ruleset=苹果服务,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/Apple.list

; === 第 5 优先级：GFW 列表（放在最后，避免覆盖前面的规则）===
ruleset=节点选择,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/ProxyGFWlist.list

; === 第 6 优先级：中国大陆直连 ===
ruleset=全球直连,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/ChinaDomain.list
ruleset=全球直连,https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/ChinaCompanyIp.list
ruleset=全球直连,[]GEOIP,CN,no-resolve

; === 第 7 优先级：兜底规则 ===
ruleset=漏网之鱼,[]FINAL


;================= 策略组部分（新增故障转移）=================

; === 主选择策略组（新增故障转移选项）===
custom_proxy_group=节点选择`select`[]AWS香港负载`[]AWS台湾负载`[]新加坡负载`[]香港负载`[]美国负载`[]澳门负载`[]AWS东京负载`[]自动选择`[]故障转移`[]DIRECT`.*

; === 自动测速组 & 故障转移 ===
custom_proxy_group=自动选择`url-test`.*`https://www.cloudflare.com/cdn-cgi/trace`600,,50
custom_proxy_group=故障转移`fallback`.*`https://www.cloudflare.com/cdn-cgi/trace`600,,50

; === 负载均衡组 ===

; 美国负载（测速间隔：600 秒，10 分钟）
custom_proxy_group=美国负载`load-balance`(洛杉矶|aws洛|美国|US|USA|America|United)`https://www.cloudflare.com/cdn-cgi/trace`600,,80

; 澳门负载（测速间隔：480 秒，8 分钟）
custom_proxy_group=澳门负载`load-balance`(澳门|澳門|debee|Jdebee|Macao|Macau)`https://www.youtube.com/generate_204`480,,80

; 新加坡负载（测速间隔：360 秒，6 分钟）
custom_proxy_group=新加坡负载`load-balance`(新加坡|SG|Singapore|狮城)`https://www.cloudflare.com/cdn-cgi/trace`360,,50

; 香港负载（只匹配"香港电视"节点）
custom_proxy_group=香港负载`load-balance`(香港电视|HK电视|TVB|mytv)`https://www.cloudflare.com/cdn-cgi/trace`480,,60

; AWS 香港负载（测速间隔：600 秒）
custom_proxy_group=AWS香港负载`load-balance`(aws香港hy2)`https://www.cloudflare.com/cdn-cgi/trace`600,,40

; AWS 台湾负载（测速间隔：600 秒）
custom_proxy_group=AWS台湾负载`load-balance`(aws台湾hy2)`https://www.cloudflare.com/cdn-cgi/trace`600,,40

; AWS 东京负载（测速间隔：360 秒）
custom_proxy_group=AWS东京负载`load-balance`(aws东京|东京|Tokyo|JP|日本)`https://www.cloudflare.com/cdn-cgi/trace`360,,50

; === 应用专用策略组（所有都添加故障转移选项）===

; ChatGPT / AI 服务 - 美国优先
custom_proxy_group=ChatGPT`select`[]美国负载`[]新加坡负载`[]AWS东京负载`[]AWS台湾负载`[]节点选择`[]自动选择`[]故障转移`[]DIRECT`(洛杉矶|美国|US)`.*

; TikTok - 美国优先
custom_proxy_group=TikTok`select`[]美国负载`[]新加坡负载`[]AWS东京负载`[]AWS台湾负载`[]节点选择`[]自动选择`[]故障转移`(洛杉矶|美国|US|新加坡|SG)`.*

; Netflix / HBO Max - 美国优先
custom_proxy_group=奈飞视频`select`[]美国负载`[]AWS东京负载`[]新加坡负载`[]节点选择`[]自动选择`[]故障转移`(洛杉矶|美国|US)`.*

; YouTube - 澳门优先（大带宽）
custom_proxy_group=油管视频`select`[]澳门负载`[]美国负载`[]AWS东京负载`[]AWS香港负载`[]AWS台湾负载`[]节点选择`[]自动选择`[]故障转移`(澳门|debee)`.*

; 香港流媒体 - 香港电视专线
custom_proxy_group=香港流媒体`select`[]香港负载`[]澳门负载`[]AWS香港负载`[]节点选择`[]故障转移`(香港电视|TVB|mytv)`[]自动选择

; Telegram - 新加坡优先（低延迟）
custom_proxy_group=电报消息`select`[]新加坡负载`[]节点选择`[]自动选择`[]故障转移

; 苹果服务 - 直连优先
custom_proxy_group=苹果服务`select`[]DIRECT`[]节点选择`[]自动选择

; 广告拦截（REJECT 优先）
custom_proxy_group=广告拦截`select`[]REJECT`[]DIRECT

; 全球直连
custom_proxy_group=全球直连`select`[]DIRECT`[]节点选择

; 漏网之鱼 - 节点选择优先
custom_proxy_group=漏网之鱼`select`[]节点选择`[]AWS香港负载`[]AWS台湾负载`[]新加坡负载`[]香港负载`[]美国负载`[]澳门负载`[]自动选择`[]故障转移`[]DIRECT`.*


;================= 规则生成器设置 =================
enable_rule_generator=true
overwrite_original_rules=true
